/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! matches.js v1.0.3 - Nicolas Gallagher - MIT license */

/*! delegate.js v1.0.2 - Nicolas Gallagher - MIT license */

/*!
 * xdm.js – Nicolas Gallagher – MIT License
 * easyXDM – Copyright(c) 2009-2011, Øyvind Sean Kinsey, oyvind@kinsey.no – MIT License
 */

!function(){var e,t,n;!function(r){function o(e,t){return y.call(e,t)}function a(e,t){var n,r,o,a,i,c,s,l,u,d,f=t&&t.split("/"),p=v.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(f=f.slice(0,f.length-1),e=f.concat(e.split("/")),l=0;l<e.length;l+=1)if(d=e[l],"."===d)e.splice(l,1),l-=1;else if(".."===d){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||m)&&p){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(u=f.length;u>0;u-=1)if(o=p[f.slice(0,u).join("/")],o&&(o=o[r])){a=o,i=l;break}if(a)break;!c&&m&&m[r]&&(c=m[r],s=l)}!a&&c&&(a=c,i=s),a&&(n.splice(0,i,a),e=n.join("/"))}return e}function i(e,t){return function(){return p.apply(r,w.call(arguments,0).concat([e,t]))}}function c(e){return function(t){return a(t,e)}}function s(e){return function(t){g[e]=t}}function l(e){if(o(E,e)){var t=E[e];delete E[e],_[e]=!0,f.apply(r,t)}if(!o(g,e)&&!o(_,e))throw new Error("No "+e);return g[e]}function u(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return v&&v.config&&v.config[e]||{}}}var f,p,m,h,g={},E={},v={},_={},y=Object.prototype.hasOwnProperty,w=[].slice;m=function(e,t){var n,r=u(e),o=r[0];return e=r[1],o&&(o=a(o,t),n=l(o)),o?e=n&&n.normalize?n.normalize(e,c(t)):a(e,t):(e=a(e,t),r=u(e),o=r[0],e=r[1],o&&(n=l(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},h={require:function(e){return i(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:d(e)}}},f=function(e,t,n,a){var c,u,d,f,p,v,y=[];if(a=a||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(f=m(t[p],a),u=f.f,"require"===u)y[p]=h.require(e);else if("exports"===u)y[p]=h.exports(e),v=!0;else if("module"===u)c=y[p]=h.module(e);else if(o(g,u)||o(E,u)||o(_,u))y[p]=l(u);else{if(!f.p)throw new Error(e+" missing "+u);f.p.load(f.n,i(a,!0),s(u),{}),y[p]=g[u]}d=n.apply(g[e],y),e&&(c&&c.exports!==r&&c.exports!==g[e]?g[e]=c.exports:d===r&&v||(g[e]=d))}else e&&(g[e]=n)},e=t=p=function(e,t,n,o,a){return"string"==typeof e?h[e]?h[e](t):l(m(e,t).f):(e.splice||(v=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},"function"==typeof n&&(n=o,o=a),o?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},4),p)},p.config=function(e){return v=e,v.deps&&p(v.deps,v.callback),p},n=function(e,t,n){t.splice||(n=t,t=[]),o(g,e)||o(E,e)||(E[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almondLib",function(){}),function(e){function t(e,t){var n,r,i=e.parentNode;if(i||a||(i=document.createDocumentFragment(),i.appendChild(e)),o)return o.call(e,t);for(n=i.querySelectorAll(t),r=n.length;r--;)if(n[r]===e)return!0;return!1}var r=Element.prototype,o=r.matches||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector||r.webkitMatchesSelector,a=function(){return o?o.call(document.createElement("a"),"a"):!1}();"object"==typeof exports?module.exports=t:"function"==typeof n&&n.amd?n("matches",[],function(){return t}):e.matches=t}(this),function(e){function r(e){function t(e){if(!r(e))throw new Error("delegate(): The argument must be an Element or Document Node");return o=e,t}function n(t,n,r){for(;n&&n!==t;){if(e(n,r))return n;n=n.parentElement}return null}function r(e){return e&&e.nodeName&&(3===e.nodeType||9===e.nodeType)?!0:!1}var o;return t.on=function(e,r,a,i,c){function s(i){(i.delegateTarget=n(o,i.target,r))&&(c===!0&&t(o).off(e,s),a.call(o,i))}return a._delegateWrapper=s,o.addEventListener(e,s,i||!1),a},t.once=function(e,n,r,o){t.on(e,n,r,o,!0)},t.off=function(e,t,n){t._delegateWrapper&&(t=t._delegateWrapper),o.removeEventListener(e,t,n||!1)},t}"object"==typeof exports?module.exports=r(t("matches")):"function"==typeof n&&n.amd?n("delegate",["matches"],r):e.delegate=r(e.matches)}(this),n("common/xhrhelper",["require","exports","module"],function(e,t,n){n.exports=function(){var e={httpMethodTypes:{GET:"get",POST:"post",PUT:"put",DELETE:"delete"},sendRequest:function(e,t,n){var r=new XMLHttpRequest;r.addEventListener("load",n.onSuccess,!0),r.addEventListener("error",n.onFailure,!0),r.addEventListener("abort",n.onFailure,!0),"boolean"==typeof n.withCredentials&&(r.withCredentials=n.withCredentials),r.open(e,t,"boolean"==typeof n.async?n.async:!0);for(var o in n.headers)n.headers.hasOwnProperty(o)&&r.setRequestHeader(o,n.headers[o]);n.body?r.send(n.body):r.send()},get:function(t,n){e.sendRequest(e.httpMethodTypes.GET,t,n)},post:function(t,n){e.sendRequest(e.httpMethodTypes.POST,t,n)}};return e}}),n("../native/js/form-handler",["require","exports","module","delegate","common/xhrhelper"],function(e,t,n){var r=e("delegate"),o=e("common/xhrhelper");n.exports=function(){var e={xhrHelper:new o,selectors:{FORM:".js-form",CALL_TO_ACTION:".js-submitForm",ROOT_TOGGLE_ELEMENT:".hasToggleElements",CARD_IFRAME:".js-macaw-cards-iframe-container iframe",SUCCESS_MESSAGE:".PromotionCardFull--SuccessMessage"},classes:{SUCCESS_ELEMENTS:"successElements",ERROR_ELEMENTS:"errorElements"},resizeEvent:null,resizeEventObject:null,init:function(){r(document).on("click",e.selectors.CALL_TO_ACTION,e.submitForm),document.createEvent?(e.resizeEvent=document.createEvent("Event"),e.resizeEvent.initEvent("resize",!0,!0)):document.createEventObject&&(e.resizeEventObject=document.createEventObject("Event"),e.resizeEventObject.eventType="resize")},teardown:function(){r(document).off("click",e.submitForm)},submitForm:function(t){t.preventDefault();var n=document.querySelector(e.selectors.FORM);if(n){var r=e.getFormData(n);e.xhrHelper.sendRequest(e.xhrHelper.httpMethodTypes.POST,n.action,{onSuccess:e.handleSuccessResponse,onFailure:e.handleErrorResponse,body:r,headers:null,withCredentials:!0})}},getFormData:function(e){var t,n,r=new FormData,o=e.querySelectorAll("input");for(t=0;n=o[t];t++)r.append(n.name,n.value);return r},handleSuccessResponse:function(t){try{var n=JSON.parse(t.target.responseText).data;if(n.display){document.querySelector(e.selectors.SUCCESS_MESSAGE).innerHTML=n.display;var r=document.querySelectorAll(e.selectors.SUCCESS_MESSAGE+" a");for(i=0;el=r[i];i++)e.toggleClassOn(el,"js-openLink"),el.setAttribute("data-pe-name","card_url_click")}}catch(o){}e.handleResponse(e.classes.SUCCESS_ELEMENTS,e.classes.ERROR_ELEMENTS)},handleErrorResponse:function(){e.handleResponse(e.classes.ERROR_ELEMENTS,null)},handleResponse:function(t,n){var r=document.querySelector(e.selectors.ROOT_TOGGLE_ELEMENT);r&&(t&&e.toggleClassOn(r,t),n&&e.toggleClassOff(r,n),e.resizeIframe())},toggleClassOff:function(t,n){t.className=t.className.replace(e.getClassStringRegEx(n),"")},toggleClassOn:function(t,n){t.className.match(e.getClassStringRegEx(n))||(t.className+=" "+n)},getClassStringRegEx:function(e){return new RegExp("(?:^|\\s)"+e+"(?!\\S)","g")},resizeIframe:function(){e.resizeEvent?window.dispatchEvent(e.resizeEvent):e.resizeEventObject&&window.fireEvent("on"+e.resizeEventObject.eventType,e.resizeEventObject)}};return e.init(),e}}),function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return"undefined"==typeof e}function o(t){return e.xdm=C,y=t,y&&(O="xdm_"+y.replace(".","_")+"_"),w}function a(e){if(!e)throw new Error("url is undefined or empty");if(/^file/.test(e))throw new Error("The file:// protocol is not supported");var t=e.toLowerCase().match(E);if(t){var n=t[2],r=t[3],o=t[4]||"";return("http:"===n&&":80"===o||"https:"===n&&":443"===o)&&(o=""),n+"//"+r+o}return e}function i(e){if(!e)throw new Error("url is undefined or empty");if(e=e.replace(_,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":location.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=location.protocol+"//"+location.host+t+e}for(;v.test(e);)e=e.replace(v,"");return e}function c(e,t){if(!t)throw new Error("parameters is undefined or null");var n=e.indexOf("#"),r=[];for(var o in t)t.hasOwnProperty(o)&&r.push(o+"="+encodeURIComponent(t[o]));return e+(-1===n?"#":"&")+r.join("&")}function s(e,t,n){var r;for(var o in t)t.hasOwnProperty(o)&&(o in e?(r=t[o],"object"==typeof r?s(e[o],r,n):n||(e[o]=t[o])):e[o]=t[o]);return e}function l(e){var t=m.cloneNode(!1);if(s(e.props,{frameBorder:0,allowTRansparency:!0,scrolling:"no",width:"100%",src:c(e.remote,{xdm_e:a(location.href),xdm_c:e.channel,xdm_p:1}),name:O+e.channel+"_provider",style:{margin:0,padding:0,border:0}}),t.id=e.props.name,delete e.props.name,!e.container)throw new Error('xdm.Rpc() configuration object missing a DOM "container" property');return s(t,e.props),e.container.appendChild(t),e.onLoad&&N(t,"load",e.onLoad),e.html&&(t.contentWindow.document.open(),t.contentWindow.document.write(e.html),t.contentWindow.document.close()),e.iframe=t,t}function u(e,t){"string"==typeof e&&(e=[e]);for(var n,r=e.length;r--;)if(n=e[r],n=new RegExp("^"===n.substr(0,1)?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),n.test(t))return!0;return!1}function d(e){var t;if(e.isHost=e.isHost||r(b.xdm_p),e.props=e.props||{},e.isHost)e.remote=i(e.remote),e.channel=e.channel||"default"+h++;else if(e.channel=b.xdm_c.replace(/["'<>\\]/g,""),e.remote=b.xdm_e.replace(/["'<>\\]/g,""),e.acl&&!u(e.acl,e.remote))throw new Error("Access denied for "+e.remote);return t=[new w.stack.PostMessageTransport(e)],t.push(new w.stack.QueueBehavior(!0)),t}function f(e){var t,n,r=e.length,o={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(n=0;r>n;n++)t=e[n],s(t,o,!0),0!==n&&(t.down=e[n-1]),n!==r-1&&(t.up=e[n+1]);return t}function p(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var m=document.createElement("IFRAME"),h=Math.floor(1e4*Math.random()),g=Function.prototype,E=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,v=/[\-\w]+\/\.\.\//,_=/([^:])\/\//g,y="",w={},C=e.xdm,O="xdm_",b=function(e){e=e.substring(1,e.length).split("&");for(var t,n={},r=e.length;r--;)t=e[r].split("="),n[t[0]]=decodeURIComponent(t[1]);return n}(location.hash),N=function(){return e.addEventListener?function(e,t,n){e.addEventListener(t,n,!1)}:function(e,t,n){e.attachEvent("on"+t,n)}}(),S=function(){return e.removeEventListener?function(e,t,n){e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent("on"+t,n)}}();s(w,{version:"1.0.0",query:b,stack:{},noConflict:o}),w.Rpc=function(e,t){var n;if(t.local)for(var r in t.local)t.local.hasOwnProperty(r)&&(n=t.local[r],"function"==typeof n&&(t.local[r]={method:n}));var o=f(d(e).concat([new w.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=a(e.remote),this.destroy=function(){o.destroy()},o.init(),this.iframe=e.iframe},w.stack.PostMessageTransport=function(t){function n(e){var n=a(e.origin),o="string"==typeof e.data;n===c&&o&&e.data.substring(0,t.channel.length+1)===t.channel+" "&&r.up.incoming(e.data.substring(t.channel.length+1),n)}var r,o,i,c;return r={outgoing:function(e,n,r){i.postMessage(t.channel+" "+e,n||c),r&&r()},destroy:function(){S(e,"message",n),o&&(i=null,o.parentNode.removeChild(o),o=null)},init:function(){if(c=a(t.remote),t.isHost){var s=function(a){a.data===t.channel+"-ready"&&(i="postMessage"in o.contentWindow?o.contentWindow:o.contentWindow.document,S(e,"message",s),N(e,"message",n),setTimeout(function(){r.up.callback(!0)},0))};N(e,"message",s),o=l(t)}else N(e,"message",n),i="postMessage"in e.parent?e.parent:e.parent.document,i.postMessage(t.channel+"-ready",c),setTimeout(function(){r.up.callback(!0)},0)}}},w.stack.QueueBehavior=function(e){function t(){var i;return e===!0&&0===o.length?void p(n):void(a||0===o.length||r||(a=!0,i=o.shift(),n.down.outgoing(i.data,i.origin,function(e){a=!1,i.callback&&setTimeout(function(){i.callback(e)},0),t()})))}var n,r,o=[],a=!0;return n={init:function(){n.down.init()},callback:function(e){a=!1;var r=n.up;t(),r.callback(e)},incoming:function(e,t){n.up.incoming(e,t)},outgoing:function(e,n,r){o.push({data:e,origin:n,callback:r}),t()},destroy:function(){r=!0,n.down.destroy()}}},w.stack.RpcBehavior=function(e,n){function o(e){e.jsonrpc="2.0",c.down.outgoing(JSON.stringify(e))}function a(e,t){var n=Array.prototype.slice;return function(){var r,a=arguments.length,i={method:t};a>0&&"function"==typeof arguments[a-1]?(a>1&&"function"==typeof arguments[a-2]?(r={success:arguments[a-2],error:arguments[a-1]},i.params=n.call(arguments,0,a-2)):(r={success:arguments[a-1]},i.params=n.call(arguments,0,a-1)),l[""+ ++s]=r,i.id=s):i.params=n.call(arguments,0),e.namedParams&&1===i.params.length&&(i.params=i.params[0]),o(i)}}function i(e,n,a,i){if(!a)return void(n&&o({id:n,error:{code:-32601,message:"Procedure not found."}}));var c,s;n?(c=function(e){c=g,o({id:n,result:e})},s=function(e,t){s=g;var r={id:n,error:{code:-32099,message:e}};t&&(r.error.data=t),o(r)}):c=s=g,t(i)||(i=[i]);try{var l=a.method.apply(a.scope,i.concat([c,s]));r(l)||c(l)}catch(u){s(u.message)}}var c,s=0,l={};return c={incoming:function(e){var t,r=JSON.parse(e);r.method?n.handle?n.handle(r,o):i(r.method,r.id,n.local[r.method],r.params):(t=l[r.id],r.error&&t.error?t.error(r.error):t.success&&t.success(r.result),delete l[r.id])},init:function(){if(n.remote)for(var t in n.remote)n.remote.hasOwnProperty(t)&&(e[t]=a(n.remote[t],t));c.down.init()},destroy:function(){for(var t in n.remote)n.remote.hasOwnProperty(t)&&e.hasOwnProperty(t)&&delete e[t];c.down.destroy()}}},"object"==typeof exports?module.exports=w:"function"==typeof provide?provide(w):"function"==typeof n&&n.amd?n("xdm",[],function(){return w}):e.xdm=w}(window),n("unification/logger",["require","exports","module"],function(e,t,n){function r(e){return function(){if(window.DEBUG){var t=Array.prototype.slice.apply(arguments);t.unshift(e),console.log.apply(console,t)}}}n.exports=r}),n("common/utils",["require","exports","module","unification/logger"],function(e,t,n){var r=e("unification/logger")("[UTILS]"),o={getConfigFromJsonIn:function(e){var t,n=document.getElementById(e),o=null;if(!n)return r(["Element with id",e,"not found"].join(" ")),o;t=n.innerHTML;try{o=JSON.parse(t)}catch(a){r(["Error while parsing json in element",e].join(" "),a)}return o},isEmpty:function(e){return!o.isDefined(e)||"string"==typeof e&&0===e.length},isDefined:function(e){return"undefined"!=typeof e&&null!==e},isObject:function(e){return o.isDefined(e)&&"object"==typeof e},toArray:function(e){return Array.prototype.slice.call(e,0)},escapeHtml:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},decodeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0].nodeValue},trigger:function(e,t){var n=new Event(t);e.dispatchEvent(n)},getFollowElements:function(e){var t,n=e&&e.target;if(n){for(;!n.dataset.userId&&n.parentElement;)n=n.parentElement;return t=n.dataset.userId,o.fetchTargetElement("data-user-id",t)}return[]},fetchTargetElement:function(e,t){var n="*["+e+'="'+t+'"]';return o.toArray(document.querySelectorAll(n))},createUrl:function(e,t){var n=e;n+=-1!==n.indexOf("?")?"&":"?";for(var r in t)n=n+encodeURIComponent(r)+"="+encodeURIComponent(t[r])+"&";return n.substr(0,n.length-1)},getTarget:function(e){return e.target}};n.exports=o}),n("common/video-interface-manager",["require","exports","module","delegate","xdm","common/utils"],function(e,t,n){function r(){var e=u.getConfigFromJsonIn("video-config"),t="";return"undefined"!=typeof e&&null!==e&&(t=u.createUrl(e.video_player_url,e.params)),t}function o(){return document.querySelectorAll(".VideoContainer")}function a(){var e=document.getElementById("ExternalIframeContainer");return e&&e.className.match(/\bAmplifyContainer\b/)?e:void 0}function i(e,t,n){var r=new l.Rpc({remote:t,container:e,isHost:!0},{local:{callVideoHostMethod:function(t){return"requestPlayerConfig"===t?JSON.parse(e.getAttribute("data-player-config")):void n.callVideoHostMethod.apply(n,arguments)}}});return r.iframe.setAttribute("allowfullscreen",""),r}function c(e){for(var t,n,a,c,s=o(),l=0;l<s.length;l++)t=s[l],n={vmap_url:t.getAttribute("data-src"),image_src:t.getAttribute("data-thumbnail"),content_id:t.getAttribute("data-content-id"),type:t.getAttribute("data-type")},c=u.createUrl(r(),n),a=i(t,c,e),e.attachVideoInterface(a)}function s(e){var t,n,r=a();r&&(t=r.getAttribute("data-player-url"),n=i(r,t,e),e.attachVideoInterface(n))}var l=(e("delegate"),e("xdm")),u=e("common/utils"),d={init:function(e){c(e),s(e)},isSupported:function(){var e=o(),t=a();return e.length>0||"undefined"!=typeof t}};n.exports=d}),n("../native/js/flex-embed",["require","exports","module"],function(e,t,n){n.exports=function(){var e,t,n=document.getElementById("ExternalIframeContainer");n&&(e=n.getAttribute("data-iframe-aspect-ratio-numerator"),t=n.getAttribute("data-iframe-aspect-ratio-denominator"),n.style.paddingBottom=100*t/e+"%")}}),n("../native/js/api-request",["require","exports","module","common/xhrhelper"],function(e,t,n){var r=e("common/xhrhelper");n.exports=function(e,t){var n=new r,o=function(){this.status>=200&&this.status<=299?e(this):t(this)},a=function(){t(this)},i={getRequest:function(e,t,r){n.get(e,{onSuccess:o,onFailure:a,body:t,withCredentials:r})},postRequest:function(e,t,r){n.post(e,{onSuccess:o,onFailure:a,body:t,withCredentials:r})}};return i}}),n("../native/js/card-data-broker",["require","exports","module","./api-request"],function(e,t,n){var r=e("./api-request");n.exports=function(e){var t,n=function(){var t="/i/cards/api/v1",n=window.location.host,r=window.location.protocol;return void 0!==e.tweetId&&void 0!=e.cardName&&void 0!==e.token&&void 0!==e.forward?r+"//"+n+t+"?tweetid="+e.tweetId+"&cardname="+e.cardName+"&authenticity_token="+e.token+"&forward="+e.forward.toString():void console.log("Missing tweetId/cardName/token/forward in card config: "+e)},o=n(),a={_onDataUpdate:null,register:function(e){a._onDataUpdate=e},unregister:function(){a._onDataUpdate=null},doRead:function(e){if(o){var n=JSON.stringify(e);return t.getRequest(o,n,!0),0}},doWrite:function(e){if(o){var n=JSON.stringify(e);return t.postRequest(o,n,!0),0}},cancel:function(){},cancelAll:function(){}},i=function(t){null!==a._onDataUpdate&&a._onDataUpdate(e.original,JSON.parse(t.response),0)},c=function(e){console.log("Request failed. "+e.responseText)};return t=new r(i,c),a}}),n("../native/js/card-helper",["require","exports","module"],function(e,t,n){n.exports=function(){var e={showElement:function(t){var n=e.queryElement(t);n&&(n.style.display="block")},hideElement:function(t){var n=e.queryElement(t);n&&(n.style.display="none")},setContent:function(t,n){var r=e.queryElement(t);r&&(r.innerHTML=n)},queryElement:function(e){var t=document.querySelector(e);return t||console.log('Element with selector "'+e+'" is not found.'),t}};return e}}),n("../native/js/card-page-controller",["require","exports","module"],function(e,t,n){n.exports=function(){var e={_currentPage:null,_loadPage:function(e){e&&"function"==typeof e.load&&e.load()},_unloadPage:function(e){e&&"function"==typeof e.unload&&e.unload()},init:function(t){e._loadPage(t),e._currentPage=t},switchToPage:function(t){return t!==e.currentPage?(e._unloadPage(e._currentPage),e._loadPage(t),e._currentPage=t,e._currentPage):void 0},getCurrentPage:function(){return e._currentPage}};return e}}),n("../native/js/poll_shared/card-poll",["require","exports","module","delegate","./../card-data-broker","./../card-helper","./../card-page-controller"],function(e,t,n){{var r=(e("delegate"),e("./../card-data-broker"),e("./../card-helper"));e("./../card-page-controller")}n.exports=function(e){var t={attribute:{POLL_OPTION:"data-poll-option",POLL_COMPLETED:"data-poll-completed"},selector:{PAGE_RESULT:".PollCardShared-resultPage",PAGE_VOTING:".PollCardShared-votingPage",CONTAINER:".PollCardShared"},cardHelper:new r,pollContainer:null,pollOptions:null,twitterInterface:e,init:function(){t.pollContainer=document.querySelector(t.selector.CONTAINER),t.pollOptions=t.pollContainer.querySelectorAll(t.selector.PAGE_VOTING+" ["+t.attribute.POLL_OPTION+"]");for(var e,n=0;e=t.pollOptions[n];n++)e.addEventListener("click",t.handleOptionClick);t.pollContainer&&!t.pollContainer.getAttribute(t.attribute.POLL_COMPLETED)&&(t.cardHelper.hideElement(t.selector.PAGE_RESULT),t.twitterInterface.handleResize())},handleOptionClick:function(){var e=this.getAttribute(t.attribute.POLL_OPTION);e&&e.length<140&&(e+=" "),t.twitterInterface.composeTweet({tweetText:e||"",scribeData:t.twitterInterface.config.scribeData});for(var n,r=0;n=t.pollOptions[r];r++)n.removeEventListener("click",t.handleOptionClick);setTimeout(function(){t.cardHelper.showElement(t.selector.PAGE_RESULT),t.cardHelper.hideElement(t.selector.PAGE_VOTING),t.twitterInterface.handleResize()},500)}};return t}}),n("../native/js/initialize",["require","exports","module","./form-handler","common/video-interface-manager","./flex-embed","./poll_shared/card-poll"],function(e,t,n){n.exports=function(t){var n={modules:{Interface:t,FormHandler:e("./form-handler"),VideoInterfaceManager:e("common/video-interface-manager"),flexEmbed:e("./flex-embed"),CardPoll:e("./poll_shared/card-poll")},serialization:{CARD:"twitter-cards-serialization",VOTING:"twitter-cards-voting-serialization"},twitterInterface:null,init:function(){var e=n.getSerialization(n.serialization.CARD);e&&n._initCard(e)},getSerialization:function(e){var t,n=document.querySelector('script[type="text/'+e+'"]');try{t=JSON.parse(n.textContent||n.innerHTML)}catch(r){}return t},_initPlayer:function(){n.modules.VideoInterfaceManager.isSupported()&&n.modules.VideoInterfaceManager.init(n.twitterInterface),n.modules.flexEmbed()},_initVoting:function(){var t=n.getSerialization(n.serialization.VOTING);if(t&&"string"==typeof t.cardClassPath)try{var r=e(t.cardClassPath),o=new r(t,n.twitterInterface);o.load()}catch(a){}},_initPoll:function(){var e=new n.modules.CardPoll(n.twitterInterface);e.init()},_initCard:function(e){var t,r=e.scribeData;if(n.twitterInterface=new n.modules.Interface,r&&(t=r.card_name))switch(t){case"__entity_animated_gif":case"__entity_video":case"amplify":case"animated_gif":case"audio":case"player":n._initPlayer();break;case"2427656750:poll_choice2_m":case"2427656750:poll_choice2_r":case"2427656750:poll_choice4_m":case"2427656750:poll_choice4_r":case"2427656750:poll_choice4_rc":case"2427656750:poll_multi_m":case"2427656750:poll_multi_r":n._initPoll();break;case"promotion":{new n.modules.FormHandler}break;case"1856447832:voting_2_choices":n._initVoting()}}};return n.init(),n}}),n("common/throttle",["require","exports","module"],function(e,t,n){n.exports=function(e,t){var n,r,o,a,i=0,c=function(){i=new Date,o=null,a=e.apply(n,r)};return function(){var s=new Date,l=t-(s-i);return n=this,r=arguments,0>=l?(clearTimeout(o),o=null,i=s,a=e.apply(n,r)):o||(o=setTimeout(c,l)),a}}}),n("../native/js/interface",["require","exports","module","delegate","common/throttle","xdm","common/utils"],function(e,t,n){{var r=e("delegate"),o=e("common/throttle"),a=e("xdm");e("common/utils")}n.exports=function(e){var t={defaultScribe:{DEFAULT_SCRIBE_ELEMENT:"platform_card"},scribeActionNames:{IMPRESSION:"impression",OPEN_LINK:"open_link",OPEN_PHOTO:"click",CARD_CLICK:"card_click"},selectors:{CARD_CLICK:".js-cardClick",CARD_CONTAINER:".TwitterCardsGrid.TwitterCard",CARD_SERIALIZATION:'script[type="text/twitter-cards-serialization"]',COMPOSE_TWEET:".js-statusComposeTweet",OPEN_LEADGEN_CONFIRM_DIALOG:".js-openLeadGenConfirmDialog",OPEN_LINK:".js-openLink",OPEN_PHOTO:".js-openPhoto",OPEN_PROFILE:".js-openProfile",OPEN_GALLERY:".js-openGallery"},dataAttrs:{CARD_URL:"data-card-url",EARNED:"data-earned",IMPRESSION_ID:"data-impression-id",OPEN_LINK:"data-open-link",P_E_NAME:"data-pe-name",SCREEN_NAME:"data-screen-name",TWEET_TEXT:"data-tweet-text",USER_ID:"data-user-id"},config:null,host:null,hostMethods:null,throttleHandleResize:null,rpcHelpers:{ready:{onReady:function(){t.host.localMethodNames(function(e){t.hostMethods=e,t.handleOnReady(t.hostMethods)})}},methods:{local:{localMethodNames:function(){return{callVideoPlayerMethod:!0}},callVideoPlayerMethod:function(){t.callVideoPlayerMethod.apply(t,arguments)}},remote:{callMethodByName:{},followAdvertiser:{},localMethodNames:{},openLeadGenConfirmDialog:{},openLinkNoScribe:{},openPhotoNoScribe:{},openProfile:{},resizeCard:{},scribe:{},statusComposeTweet:{},unfollowAdvertiser:{}}}},teardown:function(){window.removeEventListener("load",t.handleResize,!1),window.removeEventListener("resize",t.throttleHandleResize,!1),r(document).off("click",t.handleStatusComposeTweet),r(document).off("click",t.handleOpenLeadGenConfirmDialog),r(document).off("click",t.handleOpenLink),r(document).off("click",t.handleOpenPhoto),r(document).off("click",t.handleOpenProfile),r(document).off("click",t.handleCardClick),t.host.destroy&&t.host.destroy()},handleOnReady:function(e){e&&(e.statusComposeTweet&&r(document).on("click",t.selectors.COMPOSE_TWEET,t.handleStatusComposeTweet),e.openLeadGenConfirmDialog&&r(document).on("click",t.selectors.OPEN_LEADGEN_CONFIRM_DIALOG,t.handleOpenLeadGenConfirmDialog),e.openLinkNoScribe&&r(document).on("click",t.selectors.OPEN_LINK,t.handleOpenLink),e.openPhotoNoScribe&&r(document).on("click",t.selectors.OPEN_PHOTO,t.handleOpenPhoto),e.openProfile&&r(document).on("click",t.selectors.OPEN_PROFILE,t.handleOpenProfile),e.scribe&&r(document).on("click",t.selectors.CARD_CLICK,t.handleCardClick),e.resizeCard&&(t.handleResize(),window.addEventListener("load",t.handleResize,!1),window.addEventListener("resize",t.throttleHandleResize,!1)))},handlePromotedEngagement:function(e){var n=t._getPromotedEventName(e.delegateTarget);if(n){var r=t._getImpressionId(),o=!!t._getEarned();t.host.logEvent({event:n,impression_id:r,is_earned:o},!0)}},handleStatusComposeTweet:function(e){t._isSimpleClick(e)&&(t.host.statusComposeTweet({tweetText:e.delegateTarget.getAttribute(t.dataAttrs.TWEET_TEXT),scribeData:t.config.scribeData}),e.preventDefault())},handleOpenLeadGenConfirmDialog:function(e){t.host.openLeadGenConfirmDialog({}),t.handleScribe(t.scribeActionNames.IMPRESSION),e.preventDefault()},handleOpenLink:function(e){var n=e.delegateTarget,r=t._getClosestDataAttribute(n,t.dataAttrs.OPEN_LINK);"a"!==n.nodeName.toLowerCase()&&r&&window.open(r,"_blank"),t.host.openLinkNoScribe({url:n.getAttribute("href"),scribeData:t.config.scribeData}),t.handleScribe(t.scribeActionNames.OPEN_LINK)},handleOpenPhoto:function(e){var n,r,o,a={photos:[]};if(document.querySelector(t.selectors.OPEN_GALLERY))for(o=document.querySelectorAll(t.selectors.OPEN_PHOTO),n=0;r=o[n];n++)a.photos[n]={imageUrl:r.getAttribute("href"),wasClicked:r===e.delegateTarget};else a.photos.push({imageUrl:e.delegateTarget.getAttribute("href"),wasClicked:!0});a.scribeData=t.config.scribeData,t._isSimpleClick(e)&&(t.host.openPhotoNoScribe(a),t.handleScribe(t.scribeActionNames.OPEN_PHOTO),e.preventDefault())},handleOpenProfile:function(e){t._isSimpleClick(e)&&(t.host.openProfile({userId:e.delegateTarget.getAttribute(t.dataAttrs.USER_ID),userScreenName:e.delegateTarget.getAttribute(t.dataAttrs.SCREEN_NAME),scribeData:t.config.scribeData}),e.preventDefault())},handleCardClick:function(){t.handleScribe(t.scribeActionNames.CARD_CLICK)},handleResize:function(){var e=document.documentElement,n=document.querySelector(t.selectors.CARD_CONTAINER),r=560,o=n.offsetHeight,a=n.offsetWidth;"function"==typeof t.host.resizeCard&&t.host.resizeCard({height:o+"px"}),320>a&&""!==e.className?e.className="":a>=320&&r>a?e.className="mq-medium":a>=r&&(e.className="mq-medium mq-wide")},handleScribe:function(e,n){var r=n||t.defaultScribe.DEFAULT_SCRIBE_ELEMENT,e=e,o={customScribe:{element:r,action:e},scribeData:t.config.scribeData};this.host.scribe(o)},attachVideoInterface:function(e){t.videoInterface=e},callVideoPlayerMethod:function(){return t.videoInterface?t.videoInterface.callMethodByName.apply(t.videoInterface,arguments):null},callVideoHostMethod:function(){return t.hostMethods&&t.hostMethods.callMethodByName?t.host.callMethodByName.apply(t.host,arguments):void 0},composeTweet:function(e){t.host.statusComposeTweet(e)},_getConfiguration:function(e){var t={},n=document.querySelector(e);if(n)try{t=window.CONFIG=JSON.parse(n.textContent||n.innerText)}catch(r){t.scribeData="error"}else t.scribeData="error";return t},_isSimpleClick:function(e){return!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey||e.which>1)},_getPromotedEventName:function(e){return t._getClosestDataAttribute(e,t.dataAttrs.P_E_NAME)},_getImpressionId:function(){return document.querySelector(t.selectors.CARD_CONTAINER).getAttribute(t.dataAttrs.IMPRESSION_ID)},_getEarned:function(){return document.querySelector(t.selectors.CARD_CONTAINER).getAttribute(t.dataAttrs.EARNED)},_getClosestDataAttribute:function(e,n){var r;return r=e&&"html"!==e.parentElement.nodeName.toLowerCase()?e.getAttribute(n)||t._getClosestDataAttribute(e.parentElement,n):!1}};t.config=t._getConfiguration(t.selectors.CARD_SERIALIZATION);try{t.host=e||new a.Rpc(t.rpcHelpers.ready,t.rpcHelpers.methods)}catch(n){}return t.throttleHandleResize=o(t.handleResize,75),t}}),e.config({baseUrl:"/lib/js",paths:{delegate:"../bower_components/delegate.js/delegate",matches:"../bower_components/matches.js/matches",xdm:"../bower_components/xdm.js/xdm"}}),t(["../native/js/initialize","../native/js/interface"],function(e,t){e(t)}),n("main-native",function(){})}();